[01:12:25.405] [32mINFO[39m (18356): [36m🔗 Redis conectado exitosamente[39m
[01:12:25.417] [32mINFO[39m (18356): [36m🚀 Redis listo para usar[39m
[01:12:25.087] [32mINFO[39m (18356): [36m🔗 Inicializando conexión Redis...[39m
Inicializando conexión con Supabase...
✅ Conexión con Supabase establecida exitosamente
[01:12:26.179] [32mINFO[39m (18356): [36m🚀 Iniciando Worker Manager y Replication Detector...[39m
🚀 Iniciando Worker Manager
📊 Configuración: 2-8 workers
✅ Worker 1 iniciado
✅ Worker 2 iniciado
✅ Worker Manager iniciado
🔍 Iniciando detector de trades (solo detección)
✅ Detector iniciado (polling cada 2s)
It is highly recommended to use a minimum Redis version of 6.2.0
             Current: 5.0.14.1
It is highly recommended to use a minimum Redis version of 6.2.0
             Current: 5.0.14.1
It is highly recommended to use a minimum Redis version of 6.2.0
             Current: 5.0.14.1
It is highly recommended to use a minimum Redis version of 6.2.0
             Current: 5.0.14.1
🚀 Iniciando sistema de replicación con polling cada 2 segundos
🔄 [INIT] Inicializando cache de posiciones...
🔄 Inicializando cache de posiciones abiertas...
📊 Inicializando cache para 1 masters
[01:12:27.664] [32mINFO[39m (18356): [36m✅ Worker Manager y Detector iniciados correctamente[39m
[01:12:27.823] [32mINFO[39m (18356): [36m🚀 AGM Logic Backend Enterprise running on port 8080[39m
[01:12:27.823] [32mINFO[39m (18356): [36m📊 Database: SUPABASE[39m
[01:12:27.823] [32mINFO[39m (18356): [36m🔒 Security: ENABLED[39m
[01:12:27.823] [32mINFO[39m (18356): [36m📈 Metrics: ENABLED[39m
[01:12:27.826] [32mINFO[39m (18356): [36m💾 Redis: CONNECTED[39m
[01:12:27.826] [32mINFO[39m (18356): [36m🔗 Python API: https://apekapital.com:444/api/v1[39m
[01:12:27.826] [32mINFO[39m (18356): [36m🚀 Iniciando servicio de replicación...[39m
📊 [Detector] 1 masters activos, 1 relaciones
✅ Master 101308: 2 posiciones en cache
✅ Cache de posiciones inicializado
✅ [INIT] Cache inicializado correctamente
🔍 Window de búsqueda: 7200 segundos
🛡️ Deduplicación de deals: ACTIVADA
[RedisSubscriber] Connected to Redis
[RedisSubscriber] Redis client ready
[RedisSubscriber] Redis Subscriber initialized successfully
[RedisSubscriber] ✅ Subscribed to channel: copy-trading:new-deal
✅ Redis Pub/Sub connected - listening on copy-trading:new-deal
🚀 Real-time replication enabled (<1s latency)
[2025-10-10T04:12:30.236Z] 🔍 Buscando nuevas operaciones para replicar...
📊 Procesando 1 relaciones activas
🔄 Actualizando cache para 1 masters
✅ Cache actualizado: dfe5c068-bddf-419d-b816-08303dd276ea -> 101308
👥 Masters únicos a consultar: 1
📡 Consultando trades del master 101308
⏳ Detección anterior en proceso, omitiendo ciclo
⏳ El sondeo anterior aún está en proceso. Omitiendo este ciclo.
⏳ Detección anterior en proceso, omitiendo ciclo
⏳ El sondeo anterior aún está en proceso. Omitiendo este ciclo.
🆕 [Detector] 3 trades nuevos de master 101308
📦 [Detector] Encolando trade: {
  "ticket": 158808,
  "symbol": "AUDSGDc",
  "type": "BUY"
}
📦 [Detector] Encolando trade: {
  "position_id": 158909,
  "ticket": 158909,
  "event_type": "POSITION_OPENED",
  "symbol": "AUDNOKc"
}
⏳ Job 1 esperando en cola
⏳ Job 2 esperando en cola
📦 [Detector] Encolando trade: {
  "position_id": 158936,
  "ticket": 158936,
  "event_type": "POSITION_OPENED",
  "symbol": "AUDNOKc"
}
⏳ Job 3 esperando en cola
✨ [Detector] Ciclo completado en 5341ms. 3 trades encolados
📊 [Detector] 1 masters activos, 1 relaciones
⏳ El sondeo anterior aún está en proceso. Omitiendo este ciclo.
📊 Estado: 2 workers | Cola: 3 jobs (3 waiting, 0 active)
⏳ Detección anterior en proceso, omitiendo ciclo
⏳ El sondeo anterior aún está en proceso. Omitiendo este ciclo.
🔄 [Worker] Procesando trade AUDNOKc para 1 followers
🔍 DEBUG masterTrade object: {
  "position_id": 158909,
  "ticket": 158909,
  "symbol": "AUDNOKc",
  "action": 0,
  "volume": 0.01,
  "price_open": 6.6182,
  "price_current": 6.6061,
  "sl": 0,
  "tp": 0,
  "profit": -0.012,
  "time_open": 1760071395,
  "comment": "",
  "event_type": "POSITION_OPENED"
}
🔍 DEBUG masterPositionId extracted: 158909
🔄 [Worker] Procesando trade AUDSGDc para 1 followers
🔍 DEBUG masterTrade object: {
  "ticket": 158808,
  "login": 101308,
  "symbol": "AUDSGDc",
  "type": "BUY",
  "volume": 0.01,
  "open_price": 0.85307,
  "close_price": 0.85307,
  "open_time": "2025-10-10T04:09:41+00:00",
  "close_time": "2025-10-10T04:09:41+00:00",
  "stop_loss": 0,
  "take_profit": 0,
  "profit": 0,
  "swap": 0,
  "commission": -0.07,
  "comment": "",
  "status": "OPEN"
}
🔍 DEBUG masterPositionId extracted: 158808
🔄 [Worker] Procesando trade AUDNOKc para 1 followers
🔍 DEBUG masterTrade object: {
  "position_id": 158936,
  "ticket": 158936,
  "symbol": "AUDNOKc",
  "action": 0,
  "volume": 0.01,
  "price_open": 6.6144,
  "price_current": 6.6061,
  "sl": 0,
  "tp": 0,
  "profit": -0.008199999999999999,
  "time_open": 1760072143,
  "comment": "",
  "event_type": "POSITION_OPENED"
}
🔍 DEBUG masterPositionId extracted: 158936
⏳ Detección anterior en proceso, omitiendo ciclo
⏳ El sondeo anterior aún está en proceso. Omitiendo este ciclo.
✅ 11 nuevos trades encontrados para master 101308
🚀 REPLICACIÓN INSTANTÁNEA: CADCHFc para 1 followers
📤 Sending OPEN trade to follower 101383: {
  symbol: 'CADCHFc',
  volume: 0.01,
  type: 'sell',
  follower_account: '101383',
  risk_ratio: 1,
  open_price: undefined,
  stop_loss: 0,
  take_profit: 0,
  comment: 'Copy from master'
}
🔗 Calling URL: https://apekapital.com:444/api/v1/trading/replicate
✅ Trade ejecutado en follower 101383: ticket 3629039777
💾 [SAVE] masterPositionId: 158909, masterTrade.position_id: 158909, masterTrade.ticket: 158909
💾 [SAVE] Full masterTrade: {
  "position_id": 158909,
  "ticket": 158909,
  "symbol": "AUDNOKc",
  "action": 0,
  "volume": 0.01,
  "price_open": 6.6182,
  "price_current": 6.6061,
  "sl": 0,
  "tp": 0,
  "profit": -0.012,
  "time_open": 1760071395,
  "comment": "",
  "event_type": "POSITION_OPENED"
}
✅ Trade ejecutado en follower 101383: ticket 3629039778
💾 [SAVE] masterPositionId: 158808, masterTrade.position_id: undefined, masterTrade.ticket: 158808
💾 [SAVE] Full masterTrade: {
  "ticket": 158808,
  "login": 101308,
  "symbol": "AUDSGDc",
  "type": "BUY",
  "volume": 0.01,
  "open_price": 0.85307,
  "close_price": 0.85307,
  "open_time": "2025-10-10T04:09:41+00:00",
  "close_time": "2025-10-10T04:09:41+00:00",
  "stop_loss": 0,
  "take_profit": 0,
  "profit": 0,
  "swap": 0,
  "commission": -0.07,
  "comment": "",
  "status": "OPEN"
}
✅ Trade ejecutado en follower 101383: ticket 3629039779
💾 [SAVE] masterPositionId: 158936, masterTrade.position_id: 158936, masterTrade.ticket: 158936
💾 [SAVE] Full masterTrade: {
  "position_id": 158936,
  "ticket": 158936,
  "symbol": "AUDNOKc",
  "action": 0,
  "volume": 0.01,
  "price_open": 6.6144,
  "price_current": 6.6061,
  "sl": 0,
  "tp": 0,
  "profit": -0.008199999999999999,
  "time_open": 1760072143,
  "comment": "",
  "event_type": "POSITION_OPENED"
}
✅ Trade executed on follower 101383: {
  success: true,
  ticket: 3629039780,
  execution_time: 0.032997846603393555,
  error: null
}
📊 Response status: 200
⚠️ Error guardando trade en Supabase: {
  code: '23502',
  details: 'Failing row contains (4239e449-110f-492c-b138-385e0e844361, 7a5a56a9-c71d-48d0-b66a-400de84b829b, 101383, 3629039778, AUDSGDc, sell, 0.01, null, null, 0.00000, 0.00000, 0.00, 0.00, 0.00, open, 2025-10-10 04:12:41.261+00, null, Copy from master  position 158808, 2025-10-10 04:12:41.261+00, 2025-10-10 04:12:41.261+00, 158808).',
  hint: null,
  message: 'null value in column "open_price" of relation "trades" violates not-null constraint'
}
✅ [Worker] Completado: 1/1 exitosos
💾 Trade 3629039779 guardado en Supabase
✅ [Worker] Completado: 1/1 exitosos
💾 Trade 3629039777 guardado en Supabase
✅ [Worker] Completado: 1/1 exitosos
✅ Worker completó job 1
✅ Worker completó job 3
✅ Worker completó job 2
⚠️ Error guardando trade en Supabase: {
  code: '23502',
  details: 'Failing row contains (83343d69-b4b9-4b18-9f6a-36e50adbd574, 7a5a56a9-c71d-48d0-b66a-400de84b829b, 101383, 3629039780, CADCHFc, sell, 0.01, null, null, 0.00000, 0.00000, 0.00, 0.00, 0.00, open, 2025-10-10 04:12:41.285+00, null, Copy from master, 2025-10-10 04:12:41.285+00, 2025-10-10 04:12:41.285+00, null).',
  hint: null,
  message: 'null value in column "open_price" of relation "trades" violates not-null constraint'
}
✅ Replicado a 1/1 followers en tiempo real
🚀 REPLICACIÓN INSTANTÁNEA: AUDSEKc para 1 followers
📤 Sending OPEN trade to follower 101383: {
  symbol: 'AUDSEKc',
  volume: 0.01,
  type: 'sell',
  follower_account: '101383',
  risk_ratio: 1,
  open_price: undefined,
  stop_loss: 0,
  take_profit: 0,
  comment: 'Copy from master'
}
🔗 Calling URL: https://apekapital.com:444/api/v1/trading/replicate
📊 [Detector] 1 masters activos, 1 relaciones
⏳ El sondeo anterior aún está en proceso. Omitiendo este ciclo.
⏳ Detección anterior en proceso, omitiendo ciclo
⏳ El sondeo anterior aún está en proceso. Omitiendo este ciclo.
✅ Trade executed on follower 101383: {
  success: true,
  ticket: 3629039781,
  execution_time: 0.04000592231750488,
  error: null
}
📊 Response status: 200
⚠️ Error guardando trade en Supabase: {
  code: '23502',
  details: 'Failing row contains (2024bb7d-f20c-4ef0-a734-0d5cfcaebfd1, 7a5a56a9-c71d-48d0-b66a-400de84b829b, 101383, 3629039781, AUDSEKc, sell, 0.01, null, null, 0.00000, 0.00000, 0.00, 0.00, 0.00, open, 2025-10-10 04:12:45.188+00, null, Copy from master, 2025-10-10 04:12:45.188+00, 2025-10-10 04:12:45.188+00, null).',
  hint: null,
  message: 'null value in column "open_price" of relation "trades" violates not-null constraint'
}
✅ Replicado a 1/1 followers en tiempo real
🚀 REPLICACIÓN INSTANTÁNEA: BTCUSD para 1 followers
📤 Sending OPEN trade to follower 101383: {
  symbol: 'BTCUSD',
  volume: 0.01,
  type: 'sell',
  follower_account: '101383',
  risk_ratio: 1,
  open_price: undefined,
  stop_loss: 0,
  take_profit: 0,
  comment: 'Copy from master'
}
🔗 Calling URL: https://apekapital.com:444/api/v1/trading/replicate
📊 [Detector] 1 masters activos, 1 relaciones